<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è low-poly 3D ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</title>
  <style>
    :root{
      --bg:#f6f7f9; --card:#fff; --border:#e6e8ec; --text:#1f2328;
      --muted:#6b7280; --primary:#1f6feb; --primary-600:#1a5fd3; --ring:#93c5fd;
    }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, Arial, sans-serif; background:var(--bg); margin:0; color:var(--text)}
    .container{max-width:1200px; margin:24px auto; background:var(--card); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.06)}

    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px}
    .title{margin:0; font-size:18px; font-weight:800}
    .toolbar{display:flex; gap:8px; flex-wrap:wrap}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; font-weight:600; text-decoration:none; border:1px solid var(--border); background:#fff; cursor:pointer}
    .btn:hover{background:#fafafa}
    .btn-primary{background:var(--primary); color:#fff; border-color:transparent}
    .btn-primary:hover{background:var(--primary-600)}
    .icon{font-size:16px}

    /* Layout */
    .layout{display:grid; grid-template-columns:minmax(460px,1fr) 380px; gap:12px}
    .left{display:flex; flex-direction:column; gap:12px}
    .right{position:sticky; top:12px; align-self:start}

    .card{border:1px solid var(--border); border-radius:12px; background:#fcfdff}
    .card h3{margin:0; font-size:15px; font-weight:800; padding:10px 12px; border-bottom:1px solid #eef1f6}
    .card .body{padding:10px 12px}
    .muted{color:var(--muted); font-size:12px}
    label{font-size:12px; color:#3f444b; display:block; margin:6px 0 4px}
    input[type="text"], textarea{width:100%; padding:9px 10px; border:1px solid #dfe3ea; border-radius:8px; background:#fff}
    input[type="file"]{width:100%}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .row{display:flex; gap:10px; align-items:center}
    .help{font-size:12px; color:#626b7a; margin-top:4px}
    .sep{height:1px; background:#eceff4; margin:8px 0}

    /* Right: compact tabs */
    .tabs{border:1px solid var(--border); border-radius:12px; overflow:hidden; background:#fcfdff}
    .tabs .tabbar{display:flex; gap:6px; padding:8px; border-bottom:1px solid #eef1f6; background:#fff; position:sticky; top:0; z-index:1}
    .chip{padding:6px 10px; border:1px solid var(--border); border-radius:999px; cursor:pointer; font-size:12px; user-select:none}
    .chip.active{background:var(--primary); color:#fff; border-color:transparent}
    .tabpanel{display:none; padding:10px 12px; max-height:calc(100vh - 220px); overflow:auto}
    .tabpanel.active{display:block}
    .grid-3{display:grid; grid-template-columns:1fr; gap:10px}
    .small{font-size:12px}

    /* Floating action bar */
    .fab{position:sticky; bottom:8px; display:flex; gap:8px; padding:8px; background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.06); z-index:2}
    .fab .btn{padding:10px 14px}

    /* Responsive */
    @media (max-width: 980px){
      .layout{grid-template-columns:1fr}
      .right{position:static}
      .tabpanel{max-height:none}
    }
  </style>
  <script>
    function showLoading(){ document.getElementById('loading').style.display='block'; }

    // Tabs logic
    function selectTab(name){
      document.querySelectorAll('.chip').forEach(ch=>ch.classList.remove('active'));
      document.querySelectorAll('.tabpanel').forEach(p=>p.classList.remove('active'));
      document.querySelector(`.chip[data-tab="${name}"]`)?.classList.add('active');
      document.getElementById(`tab-${name}`)?.classList.add('active');
    }
    document.addEventListener('DOMContentLoaded', ()=>selectTab('styles'));

    // Presets
    function applyPreset(preset){
      const presets={
        base:{
          style1:"production-ready low poly, faceted, clean topology, neutral PBR, matte finish, balanced proportions",
          style2:"origami papercraft, folded paper, visible creases, paper fibers texture, hand-painted soft gradients, pastel palette, minimal wear",
          style3:"voxel / lego-like microblocks, chunky cubes, stepped silhouette, 8-bit 3D aesthetic, flat albedo, primary colors",
          negative:"background, black background, dark background, scenery, environment, room, floor, ground, ground shadow, base, stand, pedestal, platform, diorama, stage, multiple objects, extra parts, reflections, glossy highlight, glass, text, watermark, logo, caption, people, hands",
          guidance:"3.0",
          steps:"22"
        },
        bold:{
          style1:"production-ready low poly, clean topology, matte neutral palette",
          style2:"paper craft with pronounced folds, rough paper fibers, high contrast painted edges",
          style3:"chunky voxel with exaggerated stepped silhouette, minimal palette, toy-like",
          negative:"background, ground shadow, base, pedestal, stand, platform, diorama, reflections, text, watermark, logo, caption, people",
          guidance:"3.4",
          steps:"26"
        }
      };
      const p=presets[preset]||presets.base;
      for(const [k,v] of Object.entries(p)){
        const el=document.querySelector(`[name='${k}']`); if(el) el.value=v;
      }
      // –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
    }
    function resetToDefaults(){
      document.querySelectorAll("[data-default]").forEach(el=>{
        if(el.type==='checkbox') el.checked=(el.getAttribute('data-default')==='true');
        else el.value=el.getAttribute('data-default');
      });
    }
  </script>
</head>
<body>
  <div class="container">
    <header>
      <h1 class="title">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è low-poly 3D</h1>
      <nav class="toolbar" aria-label="–î–µ–π—Å—Ç–≤–∏—è">
        <a class="btn" href="{{ url_for('history') }}"><span class="icon">üìú</span>–ò—Å—Ç–æ—Ä–∏—è</a>
        <a class="btn" href="{{ url_for('index') }}"><span class="icon">‚ûï</span>–ù–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è</a>
      </nav>
    </header>

    <p class="muted">
      –ó–∞–≥—Ä—É–∑–∏—Ç–µ <b>–∫–∞—Ä—Ç–∏–Ω–∫—É</b> ‚Äî –±—É–¥–µ—Ç <b>1</b> –º–æ–¥–µ–ª—å. –í–≤–µ–¥–∏—Ç–µ <b>—Ç–µ–∫—Å—Ç</b> ‚Äî –±—É–¥–µ—Ç <b>3</b> –≤–∞—Ä–∏–∞–Ω—Ç–∞ (—Ä–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏).
      –ö–∞–º–µ—Ä–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞: <b>front</b>, <b>orthographic</b>. –§–æ–Ω –≤—ã—Ä–µ–∑–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    </p>

    <form method="post" enctype="multipart/form-data" onsubmit="showLoading()">
      <div class="layout">
        <!-- LEFT: Source -->
        <div class="left">
          <div class="card">
            <h3>–ò—Å—Ç–æ—á–Ω–∏–∫</h3>
            <div class="body">
              <div class="grid-2">
                <div>
                  <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞</label>
                  <input type="file" name="image" accept="image/*" />
                  <div class="help">–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Äî —Ç–µ–∫—Å—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è. –§–æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
                </div>
                <div>
                  <label>–¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç</label>
                  <textarea name="prompt" rows="8" placeholder="–ü—Ä–∏–º–µ—Ä: low poly bear head with headphones, stylized, PBR"></textarea>
                  <div class="help">–û–ø–∏—à–∏—Ç–µ <b>–æ–¥–∏–Ω</b> –æ–±—ä–µ–∫—Ç –±–µ–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ú—ã —Å–∞–º–∏ —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–π –≤–∏–¥.</div>
                </div>
              </div>

              <div class="sep"></div>
              <div class="grid-2">
                <div>
                  <label>–¶–µ–ª–µ–≤–æ–π –ª–∏–º–∏—Ç —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤</label>
                  <input type="text" name="target_face_count" value="2000" inputmode="numeric" pattern="[0-9]*" />
                  <div class="help">1000‚Äì2000. –ú–µ–Ω—å—à–µ ‚Äî –ø—Ä–æ—â–µ –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏ –±—ã—Å—Ç—Ä–µ–µ –≤ –¥–≤–∏–∂–∫–µ.</div>
                </div>
                <div class="row" style="margin-top:24px;">
                  <label><input type="checkbox" name="use_remesh" /> –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ä–µ–º–µ—à (—É–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–µ—Ç–∫—É)</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Floating actions: –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã -->
          <div class="fab">
            <button class="btn btn-primary" type="submit" title="–ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é"><span class="icon">üöÄ</span>–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn" type="button" onclick="applyPreset('base')" title="–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏">–†–µ–∫–æ–º–µ–Ω–¥. —Å—Ç–∏–ª–∏</button>
            <button class="btn" type="button" onclick="applyPreset('bold')" title="–ë–æ–ª–µ–µ —Å–º–µ–ª—ã–µ —Å—Ç–∏–ª–∏">–°–º–µ–ª—ã–µ —Å—Ç–∏–ª–∏</button>
            <button class="btn" type="button" onclick="resetToDefaults()" title="–°–±—Ä–æ—Å –∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º">–°–±—Ä–æ—Å</button>
          </div>
          <div id="loading" class="muted" style="padding:6px 2px; display:none;">‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è‚Ä¶ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ‚Ä¶</div>
        </div>

        <!-- RIGHT: Compact settings tabs -->
        <aside class="right">
          <div class="tabs" role="tablist" aria-label="–ü–∞—Ä–∞–º–µ—Ç—Ä—ã">
            <div class="tabbar">
              <div class="chip active" data-tab="styles"  onclick="selectTab('styles')">Styles</div>
              <div class="chip"        data-tab="image"   onclick="selectTab('image')">Image&nbsp;Gen</div>
              <div class="chip"        data-tab="bg"      onclick="selectTab('bg')">BG&nbsp;&amp;&nbsp;Edges</div>
              <div class="chip"        data-tab="output"  onclick="selectTab('output')">Output</div>
            </div>

            <!-- Styles -->
            <section id="tab-styles" class="tabpanel active" role="tabpanel" aria-labelledby="tab-styles">
              <div class="muted small">–¢–æ–ª—å–∫–æ –¥–ª—è <b>—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ</b> –≤–≤–æ–¥–∞: 3 —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∏–ª—è ‚Üí 3 —Ä–∞–∑–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–æ–¥–µ–ª–∏.</div>
              <label>Style #1 ‚Äî –±–∞–∑–∞ (–±–ª–∏–∑–∫–æ –∫ –∑–∞–ø—Ä–æ—Å—É)</label>
              <textarea name="style1" rows="3" data-default="{{ defaults.styles[0] }}">{{ defaults.styles[0] }}</textarea>
              <div class="help">–ü—Ä–∏–º–µ—Ä: <i>production-ready low poly, faceted, clean topology, neutral PBR, matte</i></div>

              <label>Style #2 ‚Äî –±—É–º–∞–≥–∞ / –æ—Ä–∏–≥–∞–º–∏</label>
              <textarea name="style2" rows="3" data-default="{{ defaults.styles[1] }}">{{ defaults.styles[1] }}</textarea>
              <div class="help">–ü—Ä–∏–º–µ—Ä: <i>origami papercraft, folded paper, soft gradients, paper fibers</i></div>

              <label>Style #3 ‚Äî –≤–æ–∫—Å–µ–ª–∏ / ¬´–ª–µ–≥–æ¬ª</label>
              <textarea name="style3" rows="3" data-default="{{ defaults.styles[2] }}">{{ defaults.styles[2] }}</textarea>
              <div class="help">–ü—Ä–∏–º–µ—Ä: <i>voxel / lego-like microblocks, chunky cubes, stepped silhouette</i></div>

              <div class="sep"></div>
              <div class="grid-2">
                <div>
                  <label>SEED #1</label>
                  <input type="text" name="seed1" value="{{ defaults.seeds[0] }}" data-default="{{ defaults.seeds[0] }}" inputmode="numeric" pattern="[0-9\-]*" />
                </div>
                <div>
                  <label>SEED #2</label>
                  <input type="text" name="seed2" value="{{ defaults.seeds[1] }}" data-default="{{ defaults.seeds[1] }}" inputmode="numeric" pattern="[0-9\-]*" />
                </div>
                <div>
                  <label>SEED #3</label>
                  <input type="text" name="seed3" value="{{ defaults.seeds[2] }}" data-default="{{ defaults.seeds[2] }}" inputmode="numeric" pattern="[0-9\-]*" />
                </div>
              </div>
              <div class="help">SEED —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å. –ü–æ–º–µ–Ω—è–π—Ç–µ —á–∏—Å–ª–∞ ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.</div>
            </section>

            <!-- Image Gen -->
            <section id="tab-image" class="tabpanel" role="tabpanel" aria-labelledby="tab-image">
              <label>Guidance scale</label>
              <input type="text" name="guidance_scale" value="{{ defaults.guidance }}" data-default="{{ defaults.guidance }}" />
              <div class="help">–ù–∞—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—É. <b>2.5‚Äì4.0</b> ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω; —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–æ ‚Äî –º–æ–∂–µ—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —Ñ–æ–Ω.</div>

              <label>Steps</label>
              <input type="text" name="steps" value="{{ defaults.steps }}" data-default="{{ defaults.steps }}" />
              <div class="help">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π. –û–±—ã—á–Ω–æ <b>20‚Äì30</b> –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–∞ –Ω–∞ –±–µ–ª–æ–º.</div>

              <label>Negative prompt</label>
              <textarea name="negative_prompt" rows="3" data-default="{{ defaults.negative }}">{{ defaults.negative }}</textarea>
              <div class="help">–ß—Ç–æ –Ω—É–∂–Ω–æ <b>–∏—Å–∫–ª—é—á–∏—Ç—å</b>. –ü—Ä–∏–º–µ—Ä: <i>base, pedestal, platform, ground shadow, text, logo</i></div>
            </section>

            <!-- BG & Edges -->
            <section id="tab-bg" class="tabpanel" role="tabpanel" aria-labelledby="tab-bg">
              <label><input type="checkbox" name="remove_bg" checked data-default="true" /> –£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</label>
              <div class="help">–¢—Ä–µ–±—É–µ—Ç—Å—è <code>pip install rembg onnxruntime</code>. –û—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç.</div>

              <div class="grid-2">
                <div>
                  <label>Erode px</label>
                  <input type="text" name="erode_px" value="{{ defaults.erode }}" data-default="{{ defaults.erode }}" />
                  <div class="help">–ü–æ–¥—Ä–µ–∑–∞–µ—Ç –∫—Ä–∞–π, —É–±–∏—Ä–∞—è —Ç—ë–º–Ω—ã–π –æ—Ä–µ–æ–ª. –û–±—ã—á–Ω–æ 1‚Äì4.</div>
                </div>
                <div>
                  <label>Feather px</label>
                  <input type="text" name="feather_px" value="{{ defaults.feather }}" data-default="{{ defaults.feather }}" />
                  <div class="help">–ú—è–≥–∫–æ—Å—Ç—å –∫–æ–Ω—Ç—É—Ä–∞ (0.0‚Äì3.0). –ë–æ–ª—å—à–µ ‚Äî –º—è–≥—á–µ –∫—Ä–∞–π.</div>
                </div>
              </div>
              <label style="margin-top:6px;"><input type="checkbox" name="auto_contrast" {% if defaults.auto_contrast %}checked{% endif %} data-default="{{ 'true' if defaults.auto_contrast else 'false' }}" /> Auto-contrast alpha</label>
              <div class="help">–ß—É—Ç—å –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —É –∫—Ä–∞—è, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–µ—Ä—ã—Ö ¬´–æ—Ä–µ–æ–ª–æ–≤¬ª.</div>
            </section>

            <!-- Output (—Ä–µ–∑–µ—Ä–≤ –Ω–∞ –±—É–¥—É—â–µ–µ, —á—Ç–æ–±—ã –≤–∫–ª–∞–¥–∫–∏ –±—ã–ª–∏ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã) -->
            <section id="tab-output" class="tabpanel" role="tabpanel" aria-labelledby="tab-output">
              <div class="muted small">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–≤–æ–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–¥–µ—Å—å (—Ñ–æ—Ä–º–∞—Ç—ã, –ø—Ä–µ—Å–µ—Ç—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ —Ç. –ø.). –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è .glb / .obj –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
            </section>
          </div>
        </aside>
      </div>
    </form>
  </div>
</body>
</html>
